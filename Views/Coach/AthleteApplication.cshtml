@model FITNSS.Models.CoachProfileModel

@{
    ViewData["Title"] = "Coach AthleteApplication";
}

@{
    var studentspending = ViewBag.StudentAthletePending.StudentListPending as List<FITNSS.Models.StudentAthleteProfileModel>;
    var studentsapproved = ViewBag.StudentAthleteApproved.StudentListApproved as List<FITNSS.Models.StudentAthleteProfileModel>;
}

<div class="d-flex">

    @Html.Partial("Sidebar")
    <div class="main-content-student">
        <div class="container-fluid p-5">
            <div class="d-flex justify-content-between mb-3">
                <div>
                    <h2 class="m-0">
                        Student - Athlete Application
                    </h2>
                    <p class="fs-4 text-muted m-0">Review and manage pending athlete applications </p>
                </div>
                <div>
                    <svg width="30" height="30" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="red"><path d="M12 2C16.9706 2 21 6.04348 21 11.0314V20H3V11.0314C3 6.04348 7.02944 2 12 2ZM9.5 21H14.5C14.5 22.3807 13.3807 23.5 12 23.5C10.6193 23.5 9.5 22.3807 9.5 21Z"></path></svg>
                </div>
            </div>
            <div>
                <div class="row d-flex" style="row-gap: 1rem;">
                    <div class="col-12 col-lg-4">
                        <div class="card border-0">
                            <div class="card-body d-flex align-items-center gap-4 p-3 shadow rounded-5">
                                <div class="">
                                    <svg width="60" height="60" class="p-2 rounded-circle bg-opacity-50" style="background: #D7E1FF;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#002DC3"><path d="M2 22C2 17.5817 5.58172 14 10 14C14.4183 14 18 17.5817 18 22H2ZM10 13C6.685 13 4 10.315 4 7C4 3.685 6.685 1 10 1C13.315 1 16 3.685 16 7C16 10.315 13.315 13 10 13ZM17.3628 15.2332C20.4482 16.0217 22.7679 18.7235 22.9836 22H20C20 19.3902 19.0002 17.0139 17.3628 15.2332ZM15.3401 12.9569C16.9728 11.4922 18 9.36607 18 7C18 5.58266 17.6314 4.25141 16.9849 3.09687C19.2753 3.55397 21 5.57465 21 8C21 10.7625 18.7625 13 16 13C15.7763 13 15.556 12.9853 15.3401 12.9569Z"></path></svg>
                                </div>
                                <div>
                                    <p class="m-0 fs-4">Pending Application</p>
                                    <h1 class="m-0" style="color: #002DC3;">
                                        @ViewBag.totalPendingApplications
                                    </h1>
                                    <p class="text-success m-0">Awaiting review</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="card border-0">
                            <div class="card-body d-flex align-items-center gap-4 p-3 shadow rounded-5">
                                <div class="">
                                    <svg width="60" height="60" class="p-2 rounded-circle bg-opacity-50" style="background:#DFFFD8;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#00c134"><path d="M4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12ZM12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM17.4571 9.45711L16.0429 8.04289L11 13.0858L8.20711 10.2929L6.79289 11.7071L11 15.9142L17.4571 9.45711Z"></path></svg>
                                </div>
                                <div>
                                    <p class="m-0 fs-4">Approved Today</p>
                                    <h1 class="m-0" style="color: #00c134;">@ViewBag.totalApprovedApplications</h1>
                                    <p class="text-muted m-0">Successfully processed</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="card border-0">
                            <div class="card-body d-flex align-items-center gap-4 p-3 shadow rounded-5">
                                <div class="">
                                    <svg width="60" height="60" class="p-2 rounded-circle bg-opacity-50" style="background: #F4FFB8;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#B9B91F"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"></path></svg>
                                </div>
                                <div>
                                    <p class="m-0 fs-4">Reject</p>
                                    <h1 class="m-0" style="color: #B9B91F;">@ViewBag.totalRejectApplications</h1>
                                    <p class="text-success m-0 opacity-0">test</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2 class="m-0 mt-3">
                        Submission  Management
                    </h2>
                    <div class="col-12 col-lg-6">
                        <div class="card border-0 shadow">
                            <div class="card-body p-3">
                                <div class="">
                                    <h2>Pending Submissions (56)</h2>
                                </div>
                                <div class="my-3 px-3 row" style="row-gap: 10px;">
                                    @foreach (var studentpending in ViewBag.StudentAthletePending.StudentListPending)
                                    {
                                        <div class="d-flex justify-content-between gap-4 p-2 px-4 rounded-3 shadow" style="background: #E0FFD7;border: 2px solid #90FF4B;">
                                            <div>
                                                <p class="m-0 fs-5 fw-semibold">@studentpending.FullName</p>
                                            </div>
                                            <div>
                                                <button class="btn btn-primary btn-sm">View</button>
                                                <button class="btn btn-success btn-sm approved" data-bs-toggle="modal" data-bs-target="#ApprovedModal" data-student_athlete_profile_id="@studentpending.studentAthleteProfileId">Approve</button>
                                                <button class="btn btn-danger btn-sm reject" 
                                                data-bs-toggle="modal" data-bs-target="#RejectModal"
                                                        data-student_athlete_profile_id="@studentpending.studentAthleteProfileId"
                                                        data-users_id="@studentpending.userId">
                                                    Reject
                                                </button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6">
                        <div class="card border-0 shadow">
                            <div class="card-body p-3">
                                <div class="">
                                    <h2>Approved Submissions (@ViewBag.totalApprovedApplications)</h2>
                                </div>
                                <div class="my-3 px-3 row" style="row-gap: 10px;">
                                    @foreach (var studentapproved in ViewBag.StudentAthleteApproved.StudentListApproved)
                                    {
                                        <div class="d-flex justify-content-between gap-4 p-2 px-4 rounded-3 shadow" style="background: #E0FFD7;border: 2px solid #90FF4B;">
                                            <div>
                                                <p class="m-0 fs-5 fw-semibold">@studentapproved.FullName</p>
                                            </div>
                                            <div>
                                                <button class="btn btn-primary btn-sm view" data-bs-toggle="modal" data-bs-target="#ViewModal" 
                                                data-student_athlete_profile_id="@studentapproved.studentAthleteProfileId"
                                                        data-name="@studentapproved.FullName"
                                                        data-photo="@studentapproved.Photo"
                                                        data-email="@studentapproved.Email"
                                                        data-contact_number="@studentapproved.ContactNumber"
                                                        data-date_of_birth="@studentapproved.DateOfBirth"
                                                        data-age="@studentapproved.Age"
                                                        data-height="@studentapproved.Height"
                                                        data-weight="@studentapproved.Weight"
                                                        data-course="@studentapproved.Course"
                                                        data-year_level="@studentapproved.YearLevel"
                                                        data-emergency_contact="@studentapproved.EmergencyContact"
                                                        data-sport="@studentapproved.Sport"
                                                        data-status="@studentapproved.Status">
                                                    View
                                                </button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal Approved -->
    <div class="modal fade" id="ApprovedModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" enctype="multipart/form-data" asp-controller="Coach" asp-action="Approved">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Approved</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="student_athlete_profile_id" name="studentAthleteProfileId" />
                        <h2>Are you sure you want to approved?</h2>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Reject -->
    <div class="modal fade" id="RejectModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" enctype="multipart/form-data" asp-controller="Coach" asp-action="Reject">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Reject</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" id="users_id" name="studentId" />
                        <input type="text" id="reject_student_athlete_profile_id" name="studentAthleteProfileId" />
                        <h2>Are you sure you want to reject?</h2>

                        <textarea class="form-control" rows="6" name="notifDescription"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </form>
        </div>
    </div>


    <!-- Modal View -->
    <div class="modal fade" id="ViewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Athlete Profile</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="card-body m-3">
                            <div class="card-body m-0 d-flex align-items-center">
                                <div class="px-3">
                                <img id="ProfileImage" class="rounded-circle border border-2 border-dark" src="~/images/profile.png" alt="User Image" style="width:150px; height:150px;">
                                </div>
                                <div>
                                    <p class="m-0 fs-4 fw-bold" id="fullname"></p>
                                    <p class="m-0 text-muted">EMAIL: <span id="email"></span> </p>
    
                                </div>
                            </div>

                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 col-md-6">
                                        <h2>Personal Information</h2>
                                        <div class="row" style="row-gap: 1rem;">
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Contact Number</label>
                                                    <input type="text" id="contact_number" class="form-control" readonly />
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Date of Birth</label>
                                                    <input type="text" id="date_of_birth" class="form-control" readonly />
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="row" style="row-gap: 1rem;">
                                                    <div class="col-4">
                                                        <div class="form-group">
                                                            <label>Age</label>
                                                            <input type="text" id="age" class="form-control" readonly />
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="form-group">
                                                            <label>Height (cm) </label>
                                                            <input type="text" id="height" class="form-control" readonly />
                                                        </div>
                                                    </div>
                                                    <div class="col-4">
                                                        <div class="form-group">
                                                            <label>
                                                                Weight (kg)
                                                            </label>
                                                            <input type="text" id="weight" class="form-control" readonly />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <h2>Academic & Sports Information</h2>
                                        <div class="row" style="row-gap: 1rem;">
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Course</label>
                                                    <input type="text" id="course" class="form-control" readonly />
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Year Level</label>
                                                    <input type="text" id="year_level" class="form-control" readonly />
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Emergency Contact</label>
                                                    <input type="text" id="emergency_contact" class="form-control" readonly />
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Sport</label>
                                                    <input type="text" id="sport" class="form-control" readonly />
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Status</label>
                                                    <input type="text" id="status" class="form-control" readonly />
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
        </div>
    </div>
    @Html.Partial("CoachRightSidebar", Model)

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $('.approved').click(function(){
        student_athlete_profile_id = $(this).data('student_athlete_profile_id')
        $('#student_athlete_profile_id').val(student_athlete_profile_id)
    })

    $('.reject').click(function(){
        student_athlete_profile_id = $(this).data('student_athlete_profile_id')
        $('#reject_student_athlete_profile_id').val(student_athlete_profile_id)

        users_id = $(this).data('users_id')
        $('#users_id').val(users_id)
    })

    $('.view').click(function () {
        var name = $(this).data('name');
        $('#fullname').text(name);

        var photo = $(this).data('photo');

        if (photo && photo.trim() !== "") {
        $('#ProfileImage').attr('src', photo);
    } else {
        $('#ProfileImage').attr('src', '/images/profile.png');
    }

        var email = $(this).data('email');
        $('#email').text(email);

        var contact_number = $(this).data('contact_number');
        $('#contact_number').val(contact_number);

        var age = $(this).data('age');
        $('#age').val(age);

        var height = $(this).data('height');
        $('#height').val(height);

        var weight = $(this).data('weight');
        $('#weight').val(weight);

        var course = $(this).data('course');
        $('#course').val(course);

        var year_level = $(this).data('year_level');
        $('#year_level').val(year_level);

        var emergency_contact = $(this).data('emergency_contact');
        $('#emergency_contact').val(emergency_contact);

        var sport = $(this).data('sport');
        $('#sport').val(sport);

        var status = $(this).data('status');
        $('#status').val(status);


        var date_of_birth = $(this).data('date_of_birth');
        var d = new Date(date_of_birth);
        var formatted = d.toISOString().split('T')[0];
        $('#date_of_birth').val(formatted);
    });


    
    
</script>
