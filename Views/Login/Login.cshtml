@{
    ViewData["Title"] = "Login";
    string userType = ViewBag.UserType ?? "student";
}

<div class="main-wrapper">
    @Html.Partial("Navbar")
    <div class="d-flex justify-content-center align-items-center" style="min-height: calc(100vh - 72px); padding-top: 120px;">
        <div class="col-11 col-md-8 col-lg-6 col-xl-4" style="background: black; border-radius: 20px;">
            <div class="login-box-body" style="padding: 50px 30px;">
                <div style="width: 100%;text-align: center;">
                    <img src="~/images/image 102.png" alt="User Image" width="60px">
                </div>

                <br>
                <h3 class="text-white text-center" id="loginTitle">
                    @(userType == "sdpo" ? "SDPO Login" : "Student-Athlete Login")
                </h3>
                <br>

                <!-- User Type Selection -->
                <div class="mb-3">
                    <div class="d-flex justify-content-center">
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="userType" id="studentRadio" value="student" autocomplete="off" @(userType == "student" ? "checked" : "")>
                            <label class="btn btn-outline-light" for="studentRadio">Student-Athlete</label>

                            <input type="radio" class="btn-check" name="userType" id="sdpoRadio" value="sdpo" autocomplete="off" @(userType == "sdpo" ? "checked" : "")>
                            <label class="btn btn-outline-light" for="sdpoRadio">SDPO</label>
                        </div>
                    </div>
                </div>

                <form asp-action="Login" method="POST" id="loginForm">
                    <input type="hidden" name="userType" id="selectedUserType" value="@userType">

                    <label class="text-white" id="loginLabel">
                        @(userType == "sdpo" ? "5-Digit Organization ID" : "School Email")
                    </label>
                    <div class="form-group has-feedback form-control" style="height: 45px;position: relative;">
                        <input type="@(userType == "sdpo" ? "text" : "email")"
                               name="loginInput"
                               id="loginInput"
                               placeholder="@(userType == "sdpo" ? "12345" : "Email")"
                               @(userType == "sdpo" ? "maxlength='5' pattern='[0-9]{5}'" : "")
                               style="width: 100%;height: 100%;border: unset;box-shadow: none;outline-style: none;"
                               required>
                    </div>
                    <br>
                    <label class="text-white">Password</label>
                    <div class="form-group has-feedback form-control" style="height: 45px;position: relative;">
                        <input type="password" name="password" id="password" placeholder="******" style="width: 100%;height: 100%;border: unset;box-shadow: none;outline-style: none;" required>
                        <i class="fa fa-lock toggle-password" style="top: 50%;transform: translateY(-50%);position:absolute;right: 10px;"></i>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-xs-12">
                            <button type="submit" class="btn w-100 btn-block btn-flat submit" style="color: #fff; border: unset;height: 45px;font-size: 23px;font-weight: 600;background:#E10101;" name="signin">login</button>
                        </div>
                    </div>
                    <div class="mt-3 text-center" id="registerLink" style="@(userType == "sdpo" ? "display: none;" : "")">
                        <span class="text-white">No account yet? <a href="../register/register" class="text-decoration-none text-white">Register</a></span>
                    </div>
                </form>
                <br>
                @if (ViewData["Message"] != null)
                {
                    <p class="text-center" style="background:#c169693d;color:red;padding: 6px;">@ViewData["Message"]</p>
                }
                <br>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const studentRadio = document.getElementById('studentRadio');
        const sdpoRadio = document.getElementById('sdpoRadio');
        const loginTitle = document.getElementById('loginTitle');
        const loginLabel = document.getElementById('loginLabel');
        const loginInput = document.getElementById('loginInput');
        const selectedUserType = document.getElementById('selectedUserType');
        const registerLink = document.getElementById('registerLink');

        function updateLoginForm() {
            if (studentRadio.checked) {
                loginTitle.textContent = 'Student-Athlete Login';
                loginLabel.textContent = 'School Email';
                loginInput.placeholder = 'Email';
                loginInput.type = 'email';
                loginInput.removeAttribute('maxlength');
                loginInput.removeAttribute('pattern');
                selectedUserType.value = 'student';
                registerLink.style.display = 'block';
                loginInput.value = ''; // Clear input when switching
            } else if (sdpoRadio.checked) {
                loginTitle.textContent = 'SDPO Login';
                loginLabel.textContent = '5-Digit Organization ID';
                loginInput.placeholder = '12345';
                loginInput.type = 'text';
                loginInput.setAttribute('maxlength', '5');
                loginInput.setAttribute('pattern', '[0-9]{5}');
                selectedUserType.value = 'sdpo';
                registerLink.style.display = 'none';
                loginInput.value = ''; // Clear input when switching
            }
        }

        studentRadio.addEventListener('change', updateLoginForm);
        sdpoRadio.addEventListener('change', updateLoginForm);

        // Input validation for organization ID
        loginInput.addEventListener('input', function() {
            if (sdpoRadio.checked) {
                // Only allow numbers and limit to 5 digits
                let value = this.value.replace(/[^0-9]/g, '');
                if (value.length > 5) {
                    value = value.substring(0, 5);
                }
                this.value = value;
            }
        });

        // Prevent form submission if organization ID is not exactly 5 digits
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            if (sdpoRadio.checked) {
                const orgId = loginInput.value.trim();
                if (orgId.length !== 5 || !/^\d{5}$/.test(orgId)) {
                    e.preventDefault();
                    alert('Please enter exactly 5 digits for the organization ID.');
                    return false;
                }
            }
        });

        // Initialize form
        updateLoginForm();
    });
</script>